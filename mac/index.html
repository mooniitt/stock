<!DOCTYPE html>
<html lang="zh">
<head>
  <link rel="icon" href="66.png" />
  <meta charset="UTF-8">
  <title>加载中...</title>
  <script>
    const DEFAULT_SYMBOL = "sh603256";
    const API_URL = `http://localhost:3000/quote?symbol=${DEFAULT_SYMBOL}`;
    let counter = 0;
    let lastRate = "";

    async function fetchChange() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        lastRate = data.changeRate;
        updateTitle();
      } catch (err) {
        console.error("获取失败:", err);
        lastRate = "❌";
        updateTitle();
      }
    }

    function updateTitle() {
      counter++;
      const time = new Date().toLocaleTimeString('zh-CN', { hour12: false });
      const prefix = lastRate.startsWith('-') ? '↓' : '↑';
      const formattedCounter = String(counter).padStart(5, '0');
      
      document.getElementById('counter').textContent = formattedCounter;
      document.getElementById('symbol').textContent = `${DEFAULT_SYMBOL} ${lastRate}`;
      document.title = `${prefix}${lastRate} ⏱${time}`;
    }

    setInterval(fetchChange, 1000);
    setInterval(updateTitle, 1000);
    window.onload = fetchChange;
  </script>
  <style>
    body { cursor: none; }
    #counter { opacity: 0.01; position: fixed; bottom: 0; right: 0; }
    #symbol { font-size: 18px; font-family: monospace; color: #ccc; position: fixed; top: 10px; left: 10px; }
  </style>
</head>
<body>
    <div id="counter">0</div>
    <div id="symbol"></div>
</body>
</html>
