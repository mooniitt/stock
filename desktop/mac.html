<!DOCTYPE html>
<html lang="zh">
<head>
  <link rel="icon" href="/favicon.ico" />
  <meta charset="UTF-8">
    <title>Mac 专用行情</title>
    <script>
      let DEFAULT_SYMBOL = "sh600021,sh601138,sz300490,sz002759"; // Default value
      let timer;

      // Fetch config from backend
      async function fetchConfig() {
        try {
          const response = await fetch("/api/config");
          const config = await response.json();
          DEFAULT_SYMBOL = config.defaultSymbol;
        } catch (error) {
          console.error("Error fetching config:", error);
        }
      }

      // 从 URL 获取 symbol，或者使用默认值
      function getSymbolFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("symbol") || DEFAULT_SYMBOL;
      }

      // 获取行情
      async function fetchQuotes(symbol) {
        try {
          const response = await fetch(`/cli?symbol=${symbol}`);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const data = await response.text();
          updateContent(data);
        } catch (error) {
          console.error("Error fetching quotes:", error);
          updateContent("❌ 获取失败");
        }
      }

      // 更新页面内容
      function updateContent(data) {
        const time = new Date().toLocaleTimeString('zh-CN', { hour12: false });
        document.title = `⏱${time}`;
        document.getElementById('symbol').textContent = data;
      }

      // 开始获取数据
      function startFetching() {
        const symbol = getSymbolFromURL();
        fetchQuotes(symbol); // 先立即执行一次
        // 然后每 3 秒执行一次
        timer = setInterval(() => fetchQuotes(symbol), 3000);
      }
      
      document.addEventListener('DOMContentLoaded', async () => {
        await fetchConfig();
        startFetching();
      });

    </script>
  <style>
    body { cursor: none; }
    #symbol { font-size: 18px; font-family: monospace; color: #ccc; position: fixed; top: 10px; left: 10px; white-space: pre; }
  </style>
</head>
<body>
    <div id="symbol"></div>
</body>
</html>